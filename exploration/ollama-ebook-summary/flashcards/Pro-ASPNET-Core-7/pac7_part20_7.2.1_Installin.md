# Flashcards: Pro-ASPNET-Core-7_processed (Part 20)

**Starting Chapter:** 7.2.1 Installing the Entity Framework Core packages

---

---
#### Column Attribute Usage
Explanation: The `Column` attribute is used to specify the SQL data type for a property when using Entity Framework Core. This ensures that the correct database column type is used, which might not always match directly with C# types.

:p What does the `Column` attribute do in the context of Entity Framework Core?
??x
The `Column` attribute allows you to define the specific SQL data type for a property within your entity model. For example, `[Column(TypeName = "decimal(8, 2)")]` specifies that the `Price` property should be stored as a decimal with 8 total digits and 2 fractional digits in the database.

```csharp
public class Product {
    [Column(TypeName = "decimal(8, 2)")]
    public decimal Price { get; set; }
}
```
x??

---
#### Running the Application
Explanation: Before adding data to the application, it is recommended to ensure that the application builds and runs correctly. This involves running the `dotnet run` command from within the SportsStore project folder.

:p How do you verify that your application works as expected?
??x
You can verify that your application works by running the `dotnet run` command in the SportsStore project directory. This will build and start the application, allowing you to check if it responds correctly when accessed via a web request.

```bash
cd path/to/SportsStore
dotnet run
```
Then, open a web browser or use curl to request the application at `http://localhost:5000`.

??x
You can also test this by visiting `http://localhost:5000` in your web browser. If everything is set up correctly, you should see the response generated by the SportsStore application.

```bash
curl http://localhost:5000
```
This command will return the same result as opening the URL in a browser.
x??

---
#### Adding Data to the Application
Explanation: To make the SportsStore application more useful, data needs to be added. The application uses Entity Framework Core to interact with a SQL Server LocalDB database.

:p What is required before adding data to the SportsStore application?
??x
Before you can add data to the SportsStore application, you must ensure that you have installed SQL Server LocalDB on your development environment. This is because the application requires access to this database to store and retrieve data.

If LocalDB was not installed when setting up your development environment in Chapter 2, you need to install it now. The application will not function without its database.
x??

---
#### Entity Framework Core Overview
Explanation: Entity Framework Core (EF Core) is an ORM framework developed by Microsoft for ASP.NET Core projects. It helps developers map C# objects and collections into SQL queries.

:p What is Entity Framework Core?
??x
Entity Framework Core (EF Core) is a powerful ORM framework used in ASP.NET Core applications to interact with databases. EF Core allows you to work with data using strongly-typed .NET classes, which are mapped to database tables.

```csharp
public class Product {
    public long? ProductID { get; set; }
    public string Name { get; set; } = String.Empty;
    public string Description { get; set; } = String.Empty;
    [Column(TypeName = "decimal(8, 2)")]
    public decimal Price { get; set; }
    public string Category { get; set; } = String.Empty;
}
```
Here, `Product` is an entity class that defines the structure of data in the database. The `Price` property uses a `Column` attribute to specify its SQL type as `decimal(8, 2)`.

:x??

---
#### Adding Entity Framework Core Packages
Background context: The first step is to add Entity Framework Core (EF Core) and its necessary packages to support SQL Server in your SportsStore project. This involves adding specific package references via the command line.

:p How do you add Entity Framework Core and its SQL Server support to the SportsStore project?
??x
To install these packages, run the following commands in a PowerShell command prompt from within the SportsStore folder:

```shell
dotnet add package Microsoft.EntityFrameworkCore.Design --version 7.0.0
dotnet add package Microsoft.EntityFrameworkCore.SqlServer --version 7.0.0
```

These commands add the required Entity Framework Core and SQL Server packages to your project.

x??
---
#### Installing Entity Framework Core Tools
Background context: EF Core requires tools for preparing and creating databases, especially when working with ASP.NET Core applications. These tools need to be installed globally and matched with the version of EF Core in use.

:p How do you ensure that the Entity Framework Core tools are correctly installed and up-to-date?
??x
To manage global tools like `dotnet-ef`, run these commands:

```shell
# Uninstall any existing versions of the tool package
dotnet tool uninstall --global dotnet-ef

# Install the specific version required for this book
dotnet tool install --global dotnet-ef --version 7.0.0
```

This ensures that you have the correct tools installed and can use them effectively.

x??
---
#### Defining Connection Strings in appsettings.json
Background context: Configuration settings like database connection strings are stored in JSON configuration files. For the SportsStore project, these settings need to be defined within `appsettings.json` or an environment-specific file such as `appsettings.Development.json`.

:p How do you define a database connection string for SQL Server in `appsettings.json`?
??x
Add the following entry to your `appsettings.json`:

```json
{
  "ConnectionStrings": {
    "SportsStoreConnection": "Server=(localdb)\\MSSQLLocalDB;Database=SportsStore;MultipleActiveResultSets=true"
  }
}
```

This JSON configuration specifies a LocalDB database called `SportsStore` and enables the multiple active result set (MARS) feature, which is required for certain EF Core queries.

x??
---
#### Creating the Database Context Class
Background context: Entity Framework Core uses a context class to interact with the database. This context acts as an entry point to the data model and provides methods for querying and modifying the data.

:p What is the role of `StoreDbContext` in the SportsStore project?
??x
The `StoreDbContext` class serves as the database context that interacts with the database using Entity Framework Core. It inherits from `DbContext` and includes properties to manage entities like products:

```csharp
using Microsoft.EntityFrameworkCore;
namespace SportsStore.Models {
    public class StoreDbContext : DbContext {
        public StoreDbContext(DbContextOptions<StoreDbContext> options) : base(options) { }
        public DbSet<Product> Products => Set<Product>();
    }
}
```

The `Products` property provides a way to access and manipulate product entities stored in the database.

x??
---

---
#### Configuring Entity Framework Core in SportsStore
Entity Framework Core must be configured to know which database type, connection string, and context class will manage data. The `Program.cs` file contains the configuration code for this setup.

:p How is Entity Framework Core configured in the `SportsStore` application?
??x
Entity Framework Core is configured using the `builder.Services.AddDbContext<StoreDbContext>` method with a SQL Server connection specified via the configuration settings. This ensures that EF Core knows how to interact with the database.

```csharp
builder.Services.AddDbContext<StoreDbContext>(opts =>
    opts.UseSqlServer(
        builder.Configuration["ConnectionStrings:SportsStoreConnection"]));
```

x??
---

---
#### Creating a Repository Interface and Implementation Class
A repository pattern is used to abstract data access, making it easier to change storage mechanisms later. The `IStoreRepository` interface defines the contract for accessing product data.

:p What does the `IStoreRepository` interface do in the context of SportsStore?
??x
The `IStoreRepository` interface allows components to request a sequence of `Product` objects efficiently using LINQ queries. It uses `IQueryable<Product>` which is derived from `IEnumerable<Product>` and represents a collection that can be queried.

```csharp
namespace SportsStore.Models {
    public interface IStoreRepository {
        IQueryable<Product> Products { get; }
    }
}
```

x??
---

---
#### Understanding `IQueryable<T>` vs. `IEnumerable<T>`
`IQueryable<T>` is used in repository interfaces because it allows efficient querying of data directly from the database, whereas `IEnumerable<T>` retrieves all objects first and then filters them.

:p Why is `IQueryable<T>` preferred over `IEnumerable<T>` in repository interfaces?
??x
`IQueryable<T>` is preferred because it lets you query only the required subset of data from the database using standard LINQ statements. This avoids loading unnecessary data into memory, which can be more efficient and reduce load on the server.

```csharp
using System.Linq;
var products = context.Products.Where(p => p.Category == "Sports").Take(10);
```

x??
---

---
#### Creating an Implementation of the Repository Interface
The `EFStoreRepository` class implements the `IStoreRepository` interface, mapping to the database's `Products` property.

:p How does the `EFStoreRepository` implementation work?
??x
The `EFStoreRepository` maps the `Products` property defined by the `IStoreRepository` interface onto the `Products` property of the `StoreDbContext` class. This leverages Entity Framework Core’s `DbSet<T>` to provide an `IQueryable<Product>`.

```csharp
namespace SportsStore.Models {
    public class EFStoreRepository : IStoreRepository {
        private StoreDbContext context;
        public EFStoreRepository(StoreDbContext ctx) {
            context = ctx;
        }
        public IQueryable<Product> Products => context.Products;
    }
}
```

x??
---

---
#### Adding the Repository Service to `Program.cs`
Services are created in ASP.NET Core to manage dependencies. The repository service is added as a scoped service so each HTTP request gets its own instance.

:p How does adding the `IStoreRepository` service work in `Program.cs`?
??x
The `AddScoped` method creates a scoped service, ensuring that one instance of the `EFStoreRepository` is created per HTTP request. This aligns with Entity Framework Core’s typical usage pattern.

```csharp
builder.Services.AddScoped<IStoreRepository, EFStoreRepository>();
```

x??
---

